<%= form_with(model: plant, url: [@company, plant], local: true, multiple: true) do |form| %>
  <% if plant.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(plant.errors.count, "error") %> prohibited this plant from being saved:</h2>

      <ul>
      <% plant.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <% if plant.cover.attached? %>
  <p>
    <%= image_tag plant.cover.variant(resize: '400'), class: 'img-fluid' %>
  </p>
  <% end %>

  <div class="field">
    <%= form.label 'Image Cover' %>
    <%= form.file_field :cover %>
  </div>

  <div class="field">
    <%= form.label :name %>
    <%= form.text_field :name %>
  </div>

  <div class="field">
    <%= form.label :code %>
    <%= form.text_field :code %>
  </div>

  <div class="field">
    <%= form.label :address01 %>
    <%= form.text_field :address01 %>
  </div>

  <div class="field">
    <%= form.label :address02 %>
    <%= form.text_field :address02 %>
  </div>

  <div class="field">
    <%= form.label :state %>
    <%= form.text_field :state %>
  </div>

  <div class="field">
    <%= form.label :zip %>
    <%= form.text_field :zip %>
  </div>

  <div class="field">
    <%= form.label :country_id %>
    <%= form.collection_select(:country_id, @countries, :id, :name, {prompt: 'Select a Country'})  %>
  </div>

  <div class="field">
    <%= form.label :phone %>
    <%= form.text_field :phone %>
  </div>

  <div class="field">
    <%= form.label :system_size %>

    <div class="system_size">
      <ul class="system_size__elements">
      <%= render 'system_size', plant: @plant %>
      </ul>
      <div class="system_size__bottom">
        <a href="#" class="system_size__plus">+</a>
      </div>
    </div>

    <%= form.label 'Total Size of the modules' %>
    <%= form.text_field 'system_size_total', value: @plant.system_size.reduce(:+), disabled: true %>
    <%= form.hidden_field :system_size %>
  </div>

  <div class="field">
    <%= form.label :flow_design %>
    <%= form.text_field :flow_design %>
  </div>

  <div class="field">
    <%= form.label :discharge_point_id %>
    <%= form.collection_select(:discharge_point_id, @points, :id, :name, {prompt: 'Select a Discharge Point'})  %>
  </div>

  <div class="field">
    <%= form.label :system_purpose %>
    <%= form.text_area :system_purpose %>
  </div>

  <div class="field">
    <%= form.label :report_preface %>
    <%= form.text_area :report_preface %>
  </div>

  <div class="field">
    <h3>Standards</h3>
    <table>
      <tr>
        <th>Active</th>
        <th>Name</th>
        <th>Is Range</th>
        <th colspan="2">In</th>
        <th colspan="2">Out</th>
      </tr>
    <%= form.fields_for :standards do |standard| %>
      <tr>
        <td><%= standard.check_box :enabled, class: "standard", data: { "target" => standard.object.option.name.parameterize.underscore } %></td>
        <td>
          <%= standard.label standard.object.option.name %>
          <%= standard.hidden_field :option_id, value: standard.object.option.id %>
        </td>
        <td><%= standard.check_box :isRange, class: 'check' %></td>
        <%= standard.fields_for :bounds do |bound| %>
        <% if standard.object.isRange %>
        <td class="col_span">
        <% else %>
        <td colspan="2" class="col_span">
        <% end %>
          <%= bound.hidden_field :outlet_id, value: bound.object.outlet.id %>
          <%= bound.text_field :from, placeholder: 'Number', class: "responsive #{bound.object.outlet.name.parameterize.underscore}_from" %>
        </td>
        <% if standard.object.isRange %>
        <td class="hidden">
        <% else %>
        <td class="hidden hide">
        <% end %>
          <%= bound.hidden_field :outlet_id, value: bound.object.outlet.id %>
          <%= bound.text_field :to, placeholder: 'Number', class: "responsive #{bound.object.outlet.name.parameterize.underscore}_to" %>
        </td>
        <% end %>
      </tr>
    <% end %>
    </table>
    <input class="toggle_checkbox" type="checkbox" name="toggle_checkbox" checked="checked">
    <label for="toggle_checkbox">Toggle Active</label>
  </div>

  <div class="field">
    <%= form.label 'Discharge Permit' %>
    <%= form.file_field :discharge_permit %>

    <% if plant.discharge_permit.attached? %>
    <%= link_to rails_blob_path(plant.discharge_permit, disposition: :attachment), class: 'text-icon' do %>
      <%= render 'shared/icons/document' %> <%= plant.discharge_permit.filename %>
    <% end %>
    <% end %>
  </div>

    <%= form.fields_for :sampling_lists, @samplings do |sampling_list| %>
    <div class="field">
      <h3><%= sampling_list.hidden_field :access_id, value: sampling_list.object.access.id %><%= sampling_list.object.access.name %> Samplings</h3>

      <ul class="<%= sampling_list.object.access.name.parameterize.underscore %>_samplings">
        <li class="hide no_standards">No Standard Selected</li>
        <% sampling_list.object.samplings.each do |sampling| %>
        <li class="<%= sampling.standard.option.name.parameterize.underscore %> <%= 'hide' unless sampling.standard.enabled || @is_new %>">
          <input type="checkbox"
            name="<%= sampling.sampling_list.access.name.parameterize.underscore %>[<%= sampling.standard.option.name.parameterize.underscore %>]"
            <%= 'checked' if sampling.persisted? || @is_new %>>
            <%= sampling.standard.option.name %>
        </li>
        <% end %>
      </ul>

      <div class="field">
        <%= form.label :frecuency_id %>
        <%= sampling_list.collection_select(:frecuency_id, @frecuencies, :id, :name, {prompt: 'Select a Frecuency'})  %>
      </div>

      <div class="field">
        <%= form.label :per_cycle %>
        <%= sampling_list.number_field :per_cycle, placeholder: 'Number' %>
      </div>
    </div>
    <% end %>

  <table>
    <tbody>
      <tr>
        <th>Active</th>
        <th>Task</th>
        <th>Frecuency</th>
        <th>Cycle</th>
        <th>Responsible</th>
      </tr>

    <% current_id = 0 %>
    <%= form.fields_for :log_standards, @log_standards do |log| %>
    <!-- n+1 -->
      <% if current_id != log.object.task.log_type.id %>
      <tr><td colspan="5" class="cell_division"><%= log.object.task.log_type.name %></td></tr>
      <% end %>
      <% current_id = log.object.task.log_type.id %>
      <tr>
        <%= log.hidden_field :id %>
        <td><%= log.check_box :active %></td>
        <td><%= log.object.task.name %><%= log.hidden_field :task_id %></td>
        <td><%= log.collection_select(:frecuency_id, @frecuencies, :id, :name, {prompt: 'Select a Frecuency'})  %></td>
        <td><%= log.number_field :cycle, placeholder: '1' %></td>
        <td><%= log.collection_select(:responsible, @responsibles, :first, :second, {prompt: 'Select a Responsible'} )  %></td>
      </tr>
    <% end %>
    </tbody>
  </table>

  <div class="field">
    <%= form.label 'Logbook BF Responsible' %>
    <%= form.collection_select(:logbook_bf_responsible_id, @users, :id, :full_name, {prompt: 'Select a Logbook BF Responsible'})  %>
  </div>

  <div class="field">
    <%= form.label 'Logbook BF Supervisor' %>
    <%= form.collection_select(:logbook_bf_supervisor_id, @users, :id, :full_name, {prompt: 'Select a Logbook BF Supervisor'})  %>
  </div>

  <div class="field">
    <%= form.label 'Logbook Company Responsible' %>
    <%= form.collection_select(:logbook_company_responsible_id, @users, :id, :full_name, {prompt: 'Select a Logbook Company Responsible'})  %>
  </div>

  <div class="field">
    <%= form.label :startup_date %>
    <%= form.date_select :startup_date %>
  </div>

  <div class="field">
    <%= form.label 'Plant Contact' %>
    <%= form.collection_select(:contact_id, @users, :id, :full_name, {prompt: 'Select a Company Contact'})  %>
  </div>

  <div class="field">
    <%= form.label 'BF Contact' %>
    <%= form.collection_select(:bf_contact_id, @users, :id, :full_name, {prompt: 'Select a Company Contact'})  %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
